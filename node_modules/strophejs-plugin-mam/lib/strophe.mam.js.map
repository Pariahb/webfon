{"version":3,"file":"strophe.mam.js","sources":["../src/strophe.mam.js"],"sourcesContent":["/* XEP-0313: Message Archive Management\n * Copyright (C) 2012 Kim Alvefur\n *\n * This file is MIT/X11 licensed. Please see the\n * LICENSE.txt file in the source package for more information.\n *\n * Modified by: Chris Tunbridge (github.com/Destreyf/)\n * Updated to support v0.3 of the XMPP XEP-0313 standard\n * http://xmpp.org/extensions/xep-0313.html\n *\n */\nimport { $iq, Strophe } from 'strophe.js';\n\nStrophe.addConnectionPlugin('mam', {\n    _c: null,\n    _p: [ 'with', 'start', 'end' ],\n    init: function (conn) {\n        this._c = conn;\n        Strophe.addNamespace('MAM', 'urn:xmpp:mam:2');\n    },\n    query: function (jid, options) {\n        var _p = this._p;\n        var attr = {\n            type:'set',\n            to:jid\n        };\n        options = options || {};\n        var mamAttr = {xmlns: Strophe.NS.MAM};\n        if (!!options.queryid) {\n            mamAttr.queryid = options.queryid;\n            delete options.queryid;\n        }\n        var iq = $iq(attr).c('query', mamAttr).c('x',{xmlns:'jabber:x:data', type:'submit'});\n\n        iq.c('field',{var:'FORM_TYPE', type:'hidden'}).c('value').t(Strophe.NS.MAM).up().up();\n        var i;\n        for (i = 0; i < this._p.length; i++) {\n            var pn = _p[i];\n            var p = options[pn];\n            delete options[pn];\n            if (!!p) {\n                iq.c('field',{var:pn}).c('value').t(p).up().up();\n            }\n        }\n        iq.up();\n\n        var onMessage = options.onMessage;\n        delete options.onMessage;\n        var onComplete = options.onComplete;\n        delete options.onComplete;\n        iq.cnode(new Strophe.RSM(options).toXML());\n\n        var _c = this._c;\n        var handler = _c.addHandler(onMessage, Strophe.NS.MAM, 'message', null);\n        return this._c.sendIQ(iq, function(){\n           _c.deleteHandler(handler);\n           onComplete.apply(this, arguments);\n        });\n    }\n});\n"],"names":["Strophe","$iq"],"mappings":"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"}
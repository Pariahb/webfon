{"ast":null,"code":"import _defineProperty from \"/home/paria/sandbox/projects/webfon-V2/webfonv2/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _slicedToArray from \"/home/paria/sandbox/projects/webfon-V2/webfonv2/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nvar _jsxFileName = \"/home/paria/sandbox/projects/webfon-V2/webfonv2/src/components/contact-item/index.js\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(source, true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(source).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport React, { useEffect, useState } from \"react\";\nimport avatarImage from \"../../images/avatar.jpg\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport RosterStatusDetector from \"../roster-status-detector\";\nimport $ from \"jquery\";\nimport \"./style.css\";\n\nconst ContactItem = props => {\n  const dispatch = useDispatch();\n  const connection = useSelector(state => state.connection);\n  const $iq = useSelector(state => state.$iq);\n  const showMainPage = useSelector(state => state.showMainPage);\n\n  const _useState = useState({\n    from: '',\n    time: ''\n  }),\n        _useState2 = _slicedToArray(_useState, 2),\n        lastActivity = _useState2[0],\n        setLastActivity = _useState2[1];\n\n  const sendLastActivity = useSelector(state => state.sendLastActivity);\n\n  const _useState3 = useState({}),\n        _useState4 = _slicedToArray(_useState3, 2),\n        userStatus = _useState4[0],\n        setUserStatus = _useState4[1];\n\n  const rosterStatus = useSelector(state => state.rosterStatus);\n\n  const handleRosterClick = contact => {\n    console.log(contact);\n    dispatch({\n      contact,\n      type: \"SET_SELECTED_ROSTER\"\n    });\n  };\n\n  const onLastActivity = iq => {\n    let from = $(iq).attr(\"from\"); // the jabber_id of the contact\\+\n\n    let lastActivityObj;\n    let errorType = $(iq).attr('type');\n    console.log(\"errorType\", errorType);\n    $(iq).find(\"query\").each(function () {\n      if (errorType === \"result\") {\n        let lastActivityTime = $(iq).find(\"query\").attr('seconds');\n        lastActivityObj = {\n          from: from,\n          time: lastActivityTime\n        };\n        console.log(\"lastActivityObj\", lastActivityObj);\n        setLastActivity(_objectSpread({}, lastActivity, {\n          from: lastActivityObj.from,\n          time: lastActivityObj.time\n        }));\n      }\n\n      if (errorType === \"error\") {\n        let errorMessage = $(iq).find(\"text\").text();\n        console.log(\"errorMessage\", errorMessage);\n      }\n    });\n    return true;\n  };\n\n  const getLastActivity = () => {\n    const iq = $iq({\n      type: \"get\",\n      from: connection.jid,\n      to: props.item.jid,\n      id: \"last1\"\n    }).c(\"query\", {\n      xmlns: \"jabber:iq:last\"\n    });\n    connection.sendIQ(iq);\n    connection.addHandler(onLastActivity, null, \"iq\", null, null, null);\n    console.log(\"iq\", iq);\n  };\n\n  const findRosterStatus = () => {\n    const item = rosterStatus.filter(i => i.id === props.item.jid)[0];\n    setUserStatus(item);\n  };\n\n  useEffect(() => {\n    getLastActivity();\n  }, [showMainPage]);\n  useEffect(() => {\n    findRosterStatus();\n  }, [rosterStatus]);\n\n  const millisToMinutesAndSeconds = millis => {\n    let minutes = Math.floor(millis / 60000);\n    let seconds = (millis % 60000 / 1000).toFixed(0);\n    return minutes;\n  };\n\n  return React.createElement(React.Fragment, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 81\n    },\n    __self: this\n  }, React.createElement(\"p\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 86\n    },\n    __self: this\n  }, lastActivity.time), React.createElement(\"div\", {\n    onClick: () => handleRosterClick(props.item.jid),\n    className: \"row item\",\n    id: props.item.jid,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 87\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    className: \"avatar\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 92\n    },\n    __self: this\n  }, userStatus !== undefined ? React.createElement(RosterStatusDetector, {\n    status: userStatus.status,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 94\n    },\n    __self: this\n  }) : null, React.createElement(\"img\", {\n    alt: \"avatar\",\n    src: avatarImage,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 96\n    },\n    __self: this\n  })), React.createElement(\"div\", {\n    className: \"right-side\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 98\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    className: \"extension\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 99\n    },\n    __self: this\n  }, React.createElement(\"p\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 100\n    },\n    __self: this\n  }, \"112\")), React.createElement(\"div\", {\n    className: \"contact-name\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 103\n    },\n    __self: this\n  }, React.createElement(\"p\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 104\n    },\n    __self: this\n  }, props.item.name)))));\n};\n\nexport default ContactItem;","map":{"version":3,"sources":["/home/paria/sandbox/projects/webfon-V2/webfonv2/src/components/contact-item/index.js"],"names":["React","useEffect","useState","avatarImage","useDispatch","useSelector","RosterStatusDetector","$","ContactItem","props","dispatch","connection","state","$iq","showMainPage","from","time","lastActivity","setLastActivity","sendLastActivity","userStatus","setUserStatus","rosterStatus","handleRosterClick","contact","console","log","type","onLastActivity","iq","attr","lastActivityObj","errorType","find","each","lastActivityTime","errorMessage","text","getLastActivity","jid","to","item","id","c","xmlns","sendIQ","addHandler","findRosterStatus","filter","i","millisToMinutesAndSeconds","millis","minutes","Math","floor","seconds","toFixed","undefined","status","name"],"mappings":"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","sourcesContent":["import React, {useEffect, useState} from \"react\";\nimport avatarImage from \"../../images/avatar.jpg\";\nimport {useDispatch, useSelector} from \"react-redux\";\nimport RosterStatusDetector from \"../roster-status-detector\";\nimport $ from \"jquery\";\nimport \"./style.css\";\n\nconst ContactItem = (props) => {\n    const dispatch = useDispatch();\n    const connection = useSelector(state => state.connection);\n    const $iq = useSelector(state => state.$iq);\n    const showMainPage = useSelector(state => state.showMainPage);\n    const [lastActivity, setLastActivity] = useState({from: '', time: ''});\n    const sendLastActivity = useSelector(state => state.sendLastActivity);\n    const [userStatus, setUserStatus] = useState({})\n    const rosterStatus = useSelector(state => state.rosterStatus);\n\n    const handleRosterClick = (contact) => {\n        console.log(contact);\n        dispatch({contact, type: \"SET_SELECTED_ROSTER\"});\n    };\n    const onLastActivity = (iq) => {\n\n        let from = $(iq).attr(\"from\"); // the jabber_id of the contact\\+\n        let lastActivityObj;\n        let errorType = $(iq).attr('type');\n        console.log(\"errorType\", errorType);\n\n        $(iq).find(\"query\").each(function () {\n\n            if (errorType === \"result\") {\n                let lastActivityTime = $(iq).find(\"query\").attr('seconds');\n                lastActivityObj = {\n                    from: from,\n                    time: lastActivityTime\n                };\n                console.log(\"lastActivityObj\", lastActivityObj);\n                setLastActivity({...lastActivity, from: lastActivityObj.from, time: lastActivityObj.time});\n            }\n            if (errorType === \"error\") {\n                let errorMessage = $(iq).find(\"text\").text();\n                console.log(\"errorMessage\", errorMessage)\n            }\n\n        });\n        return true\n\n    };\n    const getLastActivity = () => {\n        const iq = $iq({\n            type: \"get\",\n            from: connection.jid,\n            to: props.item.jid,\n            id: \"last1\"\n        }).c(\"query\", {xmlns: \"jabber:iq:last\"});\n        connection.sendIQ(iq);\n        connection.addHandler(onLastActivity, null, \"iq\", null, null, null);\n\n        console.log(\"iq\", iq)\n    };\n    const findRosterStatus = () => {\n        const item = rosterStatus.filter(i => i.id === props.item.jid)[0]\n        setUserStatus(item);\n    };\n\n    useEffect(() => {\n        getLastActivity();\n    }, [showMainPage]);\n\n    useEffect(() => {\n        findRosterStatus()\n    }, [rosterStatus])\n\n    const millisToMinutesAndSeconds = (millis) => {\n        let minutes = Math.floor(millis / 60000);\n        let seconds = ((millis % 60000) / 1000).toFixed(0);\n\n        return minutes;\n    };\n    return (\n        <React.Fragment>\n            {/*<button onClick={getLastActivity}>last activity</button>*/}\n            {/*<p>{lastActivity === 0 ? \"online\" : millisToMinutesAndSeconds(lastActivity.time) <= 30*/}\n            {/*    ? \"last seen recently\" : millisToMinutesAndSeconds(lastActivity.time) < 1440*/}\n            {/*        ? \"last seen within a day\" : \"last seen long time ago\"}</p>*/}\n            <p>{lastActivity.time}</p>\n            <div\n                onClick={() => handleRosterClick(props.item.jid)}\n                className=\"row item\"\n                id={props.item.jid}\n            >\n                <div className=\"avatar\">\n                    {\n                        userStatus !== undefined ? <RosterStatusDetector status={userStatus.status}/> : null\n                    }\n                    <img alt=\"avatar\" src={avatarImage}/>\n                </div>\n                <div className=\"right-side\">\n                    <div className=\"extension\">\n                        <p>112</p>\n                    </div>\n\n                    <div className=\"contact-name\">\n                        <p>{props.item.name}</p>\n                    </div>\n                </div>\n            </div>\n\n        </React.Fragment>\n    );\n\n};\n\n\nexport default ContactItem;\n"]},"metadata":{},"sourceType":"module"}
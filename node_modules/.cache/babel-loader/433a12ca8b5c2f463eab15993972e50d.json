{"ast":null,"code":"\"use strict\";\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  return Constructor;\n}\n\nvar JsSIP_C = require('../Constants');\n\nvar debug = require('debug')('JsSIP:RTCSession:ReferNotifier');\n\nvar C = {\n  event_type: 'refer',\n  body_type: 'message/sipfrag;version=2.0',\n  expires: 300\n};\n\nmodule.exports =\n/*#__PURE__*/\nfunction () {\n  function ReferNotifier(session, id, expires) {\n    _classCallCheck(this, ReferNotifier);\n\n    this._session = session;\n    this._id = id;\n    this._expires = expires || C.expires;\n    this._active = true; // The creation of a Notifier results in an immediate NOTIFY.\n\n    this.notify(100);\n  }\n\n  _createClass(ReferNotifier, [{\n    key: \"notify\",\n    value: function notify(code, reason) {\n      debug('notify()');\n\n      if (this._active === false) {\n        return;\n      }\n\n      reason = reason || JsSIP_C.REASON_PHRASE[code] || '';\n      var state;\n\n      if (code >= 200) {\n        state = 'terminated;reason=noresource';\n      } else {\n        state = \"active;expires=\".concat(this._expires);\n      } // Put this in a try/catch block.\n\n\n      this._session.sendRequest(JsSIP_C.NOTIFY, {\n        extraHeaders: [\"Event: \".concat(C.event_type, \";id=\").concat(this._id), \"Subscription-State: \".concat(state), \"Content-Type: \".concat(C.body_type)],\n        body: \"SIP/2.0 \".concat(code, \" \").concat(reason),\n        eventHandlers: {\n          // If a negative response is received, subscription is canceled.\n          onErrorResponse: function onErrorResponse() {\n            this._active = false;\n          }\n        }\n      });\n    }\n  }]);\n\n  return ReferNotifier;\n}();","map":null,"metadata":{},"sourceType":"script"}
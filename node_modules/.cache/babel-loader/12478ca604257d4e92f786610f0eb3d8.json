{"ast":null,"code":"var _jsxFileName = \"/home/paria/sandbox/projects/webfon-V2/webfonv2/src/components/call/make-call/index.js\";\nimport React from \"react\";\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\nimport { faPhone, faSpinner } from \"@fortawesome/free-solid-svg-icons\";\nimport \"./style.css\";\n\nconst MakeCall = () => {\n  let JsSIP = require('jssip');\n\n  const socket = new JsSIP.WebSocketInterface('wss://77.104.116.187:7000/ws');\n  let configuration = {\n    'uri': '704@admin',\n    // FILL SIP URI HERE like sip:sip-user@your-domain.bwapp.bwsip.io\n    'password': '704704',\n    // FILL PASSWORD HERE,\n    'sockets': [socket],\n    'register': true\n  };\n  const ua = new JsSIP.UA(configuration); // const incomingCallAudio = new window.Audio('http://code.bandwidth.com/media/incoming_alert.mp3');\n  // incomingCallAudio.loop = true;\n\n  const remoteAudio = new window.Audio();\n  remoteAudio.autoplay = true;\n  const callOptions = {\n    mediaConstraints: {\n      audio: true,\n      video: false\n    }\n  };\n  console.log('ua', ua); // JsSIP.debug.enable('JsSIP:*'); // more detailed debug output\n\n  console.log(ua._status);\n  /*------New incoming or outgoing call event-----*/\n\n  ua.on('newRTCSession', function (e) {\n    console.log(\"newRTCSession\");\n  });\n  /*------New incoming or outgoing call event-----*/\n\n  /*------WebSocket connection events-----*/\n\n  ua.on('connected', function (e) {\n    console.log(\"connect\");\n  });\n  ua.on('disconnected', function (e) {\n    console.log(\"disconnected\");\n  });\n  /*------WebSocket connection events-----*/\n\n  /*------SIP registration events-----*/\n\n  ua.on(\"registered\", function (e) {\n    console.log(\"registered\");\n  });\n  ua.on(\"unregistered\", function (e) {\n    console.log(\"registered\");\n  });\n  ua.on('registrationFailed', function (e) {\n    alert(\"registrationFailed\");\n  });\n  /*--------SIP registration events-----------*/\n\n  ua.start();\n  JsSIP.debug.enable('JsSIP:*'); // more detailed debug output\n  // Register callbacks to desired call events\n\n  const eventHandlers = {\n    'progress': function (e) {\n      console.log('call is in progress');\n    },\n    'failed': function (e) {\n      console.log('call failed with cause: ' + e.data.cause);\n    },\n    'ended': function (e) {\n      console.log('call ended with cause: ' + e.data.cause);\n    },\n    'confirmed': function (e) {\n      console.log('call confirmed');\n    }\n  };\n  let options = {\n    'eventHandlers': eventHandlers,\n    'mediaConstraints': {\n      'audio': true,\n      'video': true\n    }\n  };\n  let session = ua.call('sip:712@admin', options);\n  console.log(\"sip\", JsSIP.status);\n\n  const onSipConnect = () => {\n    JsSIP.debug.enable('JsSIP:*'); // more detailed debug output\n\n    ua.on('registrationFailed', function (ev) {\n      alert('Registering on SIP server failed with error: ' + ev.cause);\n      configuration.uri = null;\n      configuration.password = null;\n    });\n    ua.on('newRTCSession', function (ev) {\n      let newSession = ev.session;\n\n      if (session) {\n        // hangup any existing call\n        session.terminate();\n      }\n\n      session = newSession;\n\n      let completeSession = function () {\n        session = null;\n      };\n\n      session.on('ended', completeSession);\n      session.on('failed', completeSession); // session.on('accepted',updateUI);\n\n      session.on('confirmed', function () {\n        var localStream = session.connection.getLocalStreams()[0];\n        var dtmfSender = session.connection.createDTMFSender(localStream.getAudioTracks()[0]);\n\n        session.sendDTMF = function (tone) {\n          dtmfSender.insertDTMF(tone);\n        };\n      });\n      session.on('addstream', function (e) {\n        // incomingCallAudio.pause();\n        remoteAudio.src = window.URL.createObjectURL(e.stream);\n      });\n\n      if (session.direction === 'incoming') {} // incomingCallAudio.play();\n      // updateUI();\n\n    });\n    ua.start();\n  };\n\n  return React.createElement(React.Fragment, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 126\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    id: \"callControl\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 127\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    id: \"to\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 128\n    },\n    __self: this\n  }, React.createElement(\"input\", {\n    id: \"toField\",\n    type: \"text\",\n    placeholder: \"Enter number here\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 129\n    },\n    __self: this\n  })), React.createElement(\"button\", {\n    id: \"connectCall\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 131\n    },\n    __self: this\n  }, React.createElement(FontAwesomeIcon, {\n    className: \"fap fa-phone\",\n    icon: faPhone,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 132\n    },\n    __self: this\n  }))));\n};\n\nexport default MakeCall;","map":{"version":3,"sources":["/home/paria/sandbox/projects/webfon-V2/webfonv2/src/components/call/make-call/index.js"],"names":["React","FontAwesomeIcon","faPhone","faSpinner","MakeCall","JsSIP","require","socket","WebSocketInterface","configuration","ua","UA","remoteAudio","window","Audio","autoplay","callOptions","mediaConstraints","audio","video","console","log","_status","on","e","alert","start","debug","enable","eventHandlers","data","cause","options","session","call","status","onSipConnect","ev","uri","password","newSession","terminate","completeSession","localStream","connection","getLocalStreams","dtmfSender","createDTMFSender","getAudioTracks","sendDTMF","tone","insertDTMF","src","URL","createObjectURL","stream","direction"],"mappings":"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","sourcesContent":["import React from \"react\";\nimport {FontAwesomeIcon} from \"@fortawesome/react-fontawesome\";\nimport {faPhone, faSpinner} from \"@fortawesome/free-solid-svg-icons\";\n\nimport \"./style.css\"\n\nconst MakeCall = () => {\n    let JsSIP = require('jssip');\n\n    const socket = new JsSIP.WebSocketInterface('wss://77.104.116.187:7000/ws');\n    let configuration = {\n        'uri': '704@admin', // FILL SIP URI HERE like sip:sip-user@your-domain.bwapp.bwsip.io\n        'password': '704704', // FILL PASSWORD HERE,\n        'sockets': [socket],\n        'register' : true\n    };\n    const ua = new JsSIP.UA(configuration);\n\n    // const incomingCallAudio = new window.Audio('http://code.bandwidth.com/media/incoming_alert.mp3');\n    // incomingCallAudio.loop = true;\n    const remoteAudio = new window.Audio();\n    remoteAudio.autoplay = true;\n\n    const callOptions = {\n        mediaConstraints: {audio: true, video: false}\n    };\n    console.log('ua', ua);\n    // JsSIP.debug.enable('JsSIP:*'); // more detailed debug output\n    console.log(ua._status)\n    /*------New incoming or outgoing call event-----*/\n\n    ua.on('newRTCSession', function (e) {\n        console.log(\"newRTCSession\")\n\n    });\n    /*------New incoming or outgoing call event-----*/\n    /*------WebSocket connection events-----*/\n\n    ua.on('connected', function (e) {\n        console.log(\"connect\")\n    });\n    ua.on('disconnected', function (e) {\n        console.log(\"disconnected\")\n    });\n    /*------WebSocket connection events-----*/\n\n    /*------SIP registration events-----*/\n    ua.on(\"registered\", function (e) {\n        console.log(\"registered\")\n    });\n    ua.on(\"unregistered\", function (e) {\n        console.log(\"registered\")\n    });\n    ua.on('registrationFailed', function (e) {\n        alert(\"registrationFailed\")\n    });\n    /*--------SIP registration events-----------*/\n\n    ua.start();\n    JsSIP.debug.enable('JsSIP:*'); // more detailed debug output\n\n// Register callbacks to desired call events\n    const eventHandlers = {\n        'progress': function (e) {\n            console.log('call is in progress');\n        },\n        'failed': function (e) {\n            console.log('call failed with cause: ' + e.data.cause);\n        },\n        'ended': function (e) {\n            console.log('call ended with cause: ' + e.data.cause);\n        },\n        'confirmed': function (e) {\n            console.log('call confirmed');\n        }\n    };\n\n    let options = {\n        'eventHandlers': eventHandlers,\n        'mediaConstraints': {'audio': true, 'video': true}\n    };\n\n    let session = ua.call('sip:712@admin', options);\n    console.log(\"sip\", JsSIP.status);\n\n    const onSipConnect = () => {\n        JsSIP.debug.enable('JsSIP:*'); // more detailed debug output\n        ua.on('registrationFailed', function (ev) {\n            alert('Registering on SIP server failed with error: ' + ev.cause);\n            configuration.uri = null;\n            configuration.password = null;\n        });\n        ua.on('newRTCSession', function (ev) {\n            let newSession = ev.session;\n            if (session) { // hangup any existing call\n                session.terminate();\n            }\n            session = newSession;\n            let completeSession = function () {\n                session = null;\n\n            };\n            session.on('ended', completeSession);\n            session.on('failed', completeSession);\n            // session.on('accepted',updateUI);\n            session.on('confirmed', function () {\n                var localStream = session.connection.getLocalStreams()[0];\n                var dtmfSender = session.connection.createDTMFSender(localStream.getAudioTracks()[0])\n                session.sendDTMF = function (tone) {\n                    dtmfSender.insertDTMF(tone);\n                };\n            });\n            session.on('addstream', function (e) {\n                // incomingCallAudio.pause();\n                remoteAudio.src = window.URL.createObjectURL(e.stream);\n            });\n            if (session.direction === 'incoming') {\n                // incomingCallAudio.play();\n            }\n            // updateUI();\n        });\n        ua.start();\n    };\n    return (\n\n        <React.Fragment>\n            <div id=\"callControl\">\n                <div id=\"to\">\n                    <input id=\"toField\" type=\"text\" placeholder=\"Enter number here\"/>\n                </div>\n                <button id=\"connectCall\">\n                    <FontAwesomeIcon className=\"fap fa-phone\"\n                                     icon={faPhone}/>\n\n                </button>\n            </div>\n        </React.Fragment>\n    )\n};\n\nexport default MakeCall;\n"]},"metadata":{},"sourceType":"module"}
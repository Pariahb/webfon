{"ast":null,"code":"import _slicedToArray from \"/home/paria/sandbox/projects/webfon-V2/webfonv2/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nvar _jsxFileName = \"/home/paria/sandbox/projects/webfon-V2/webfonv2/src/components/contacts-list/index.js\";\nimport React, { useEffect, useState } from \"react\";\nimport ContactItem from \"../contact-item\";\nimport \"./style.css\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport $ from \"jquery\";\n\nconst ContactsList = () => {\n  const dispatch = useDispatch();\n  const showMainPage = useSelector(state => state.showMainPage);\n  const connection = useSelector(state => state.connection);\n  const rosterStatus = useSelector(state => state.rosterStatus);\n\n  const _useState = useState('chat'),\n        _useState2 = _slicedToArray(_useState, 2),\n        rosterStatusColor = _useState2[0],\n        setRosterStatusColor = _useState2[1];\n\n  useEffect(() => {\n    setRosterStatusColor(rosterStatus);\n    console.log(\"test\");\n  }, [rosterStatus]);\n  const contacts = useSelector(state => state.contacts);\n  /*----------get contact presence-----------*/\n  //use presences from xmpp server\n\n  const onPresence = presence => {\n    $(presence).each(function () {\n      let from = $(presence).attr(\"from\"); // the jabber_id of the contact\\\n\n      if (from.split(\"/\", 1)[0] === props.item.jid) {\n        if (from !== connection.jid) {\n          let presence_type = $(presence).attr(\"type\"); // unavailable, subscribed, etc...\n\n          console.log(\"presence\", presence);\n\n          if (!presence_type) {\n            let show = $(presence).find(\"show\").text(); // this is what gives away, dnd, etc.\n\n            if (!show) {\n              if (presence_type === \"unavailable\") {\n                // Mark contact as offline\n                changeRosterStatus(\"xa\");\n                console.log(\"presence_type2\", presence_type);\n                console.log(from + \"contact as unavailable\");\n              } else {\n                // Mark contact as offline\n                changeRosterStatus(\"chat\");\n                console.log(\"presence_type2\", presence_type);\n              }\n            } else {\n              switch (show) {\n                case \"chat\":\n                  changeRosterStatus(\"chat\"); // Mark contact as online\n\n                  console.log(from + \"contact as online\");\n                  break;\n\n                case \"away\":\n                  changeRosterStatus(\"away\");\n                  console.log(from + \"contact as away\");\n                  break;\n\n                case \"dnd\":\n                  changeRosterStatus(\"dnd\");\n                  console.log(from + \"contact as dnd\");\n                  break;\n\n                case \"xa\":\n                  changeRosterStatus(\"xa\");\n                  console.log(from + \"contact as xa\");\n                  break;\n\n                default:\n                  changeRosterStatus(\"chat\");\n              }\n            }\n          }\n        }\n      }\n    });\n    return true; //The handler should return true if it is to be invoked again; returning false will remove the handler after it returns\n  };\n  /*---------------------------------*/\n  //change each roster status.\n\n\n  const changeRosterStatus = rosterStatus => {\n    dispatch({\n      rosterStatus,\n      type: 'CHANGE_EACH_ROSTER_STATUS'\n    });\n  };\n  /*---------------------------------*/\n\n\n  useEffect(() => {\n    connection.addHandler(onPresence, null, \"presence\", null, null, null);\n  }, [showMainPage]);\n  /*----------get contact presence-----------*/\n\n  return React.createElement(React.Fragment, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 101\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    className: \"col-sm-4 contacts\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 102\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    className: \"header\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 103\n    },\n    __self: this\n  }, React.createElement(\"p\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 104\n    },\n    __self: this\n  }, \"\\u0644\\u06CC\\u0633\\u062A \\u067E\\u06CC\\u0627\\u0645 \\u0647\\u0627\"), React.createElement(\"p\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 105\n    },\n    __self: this\n  }, \"\\u0627\\u0641\\u0631\\u0627\\u062F \\u0622\\u0646\\u0644\\u0627\\u06CC\\u0646 (\\u06F4 \\u0646\\u0641\\u0631)\")), contacts.map((item, i) => {\n    console.log(item); // Return the element. Also pass key\n\n    return React.createElement(ContactItem, {\n      key: i,\n      item: item,\n      rosterStatusColor: rosterStatusColor,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 111\n      },\n      __self: this\n    });\n  })));\n};\n\nexport default ContactsList;","map":{"version":3,"sources":["/home/paria/sandbox/projects/webfon-V2/webfonv2/src/components/contacts-list/index.js"],"names":["React","useEffect","useState","ContactItem","useDispatch","useSelector","$","ContactsList","dispatch","showMainPage","state","connection","rosterStatus","rosterStatusColor","setRosterStatusColor","console","log","contacts","onPresence","presence","each","from","attr","split","props","item","jid","presence_type","show","find","text","changeRosterStatus","type","addHandler","map","i"],"mappings":"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","sourcesContent":["import React, {useEffect, useState} from \"react\";\nimport ContactItem from \"../contact-item\";\nimport \"./style.css\";\nimport {useDispatch, useSelector} from \"react-redux\";\nimport $ from \"jquery\";\n\nconst ContactsList = () => {\n    const dispatch = useDispatch();\n    const showMainPage = useSelector(state => state.showMainPage);\n    const connection = useSelector(state => state.connection);\n    const rosterStatus = useSelector(state => state.rosterStatus);\n    const [rosterStatusColor, setRosterStatusColor] = useState('chat');\n\n    useEffect(() => {\n        setRosterStatusColor(rosterStatus)\n        console.log(\"test\")\n\n    }, [rosterStatus]);\n\n    const contacts = useSelector(state => state.contacts)\n    /*----------get contact presence-----------*/\n    //use presences from xmpp server\n    const onPresence = (presence) => {\n\n        $(presence).each(function () {\n                let from = $(presence).attr(\"from\"); // the jabber_id of the contact\\\n\n                if (from.split(\"/\", 1)[0] === props.item.jid) {\n                    if (from !== connection.jid) {\n                        let presence_type = $(presence).attr(\"type\"); // unavailable, subscribed, etc...\n                        console.log(\"presence\", presence)\n                        if (!presence_type) {\n                            let show = $(presence)\n                                .find(\"show\")\n                                .text(); // this is what gives away, dnd, etc.\n                            if (!show) {\n                                if (presence_type === \"unavailable\") {\n                                    // Mark contact as offline\n                                    changeRosterStatus(\"xa\");\n                                    console.log(\"presence_type2\", presence_type)\n\n                                    console.log(from + \"contact as unavailable\");\n\n                                } else {\n                                    // Mark contact as offline\n                                    changeRosterStatus(\"chat\");\n                                    console.log(\"presence_type2\", presence_type);\n                                }\n                            } else {\n                                switch (show) {\n                                    case \"chat\" :\n                                        changeRosterStatus(\"chat\");\n                                        // Mark contact as online\n                                        console.log(from + \"contact as online\");\n                                        break;\n                                    case \"away\" :\n                                        changeRosterStatus(\"away\");\n                                        console.log(from + \"contact as away\");\n                                        break;\n                                    case \"dnd\":\n                                        changeRosterStatus(\"dnd\");\n                                        console.log(from + \"contact as dnd\");\n                                        break;\n                                    case \"xa\":\n                                        changeRosterStatus(\"xa\");\n                                        console.log(from + \"contact as xa\");\n                                        break;\n                                    default :\n                                        changeRosterStatus(\"chat\");\n\n                                }\n                            }\n\n                        }\n                    }\n                }\n            }\n        )\n\n\n        return true; //The handler should return true if it is to be invoked again; returning false will remove the handler after it returns\n    }\n    /*---------------------------------*/\n//change each roster status.\n    const changeRosterStatus = (rosterStatus) => {\n        dispatch({rosterStatus, type: 'CHANGE_EACH_ROSTER_STATUS'})\n    }\n    /*---------------------------------*/\n    useEffect(() => {\n        connection.addHandler(\n            onPresence,\n            null,\n            \"presence\",\n            null,\n            null,\n            null\n        );\n    }, [showMainPage]);\n    /*----------get contact presence-----------*/\n    return (\n        <React.Fragment>\n            <div className=\"col-sm-4 contacts\">\n                <div className=\"header\">\n                    <p>لیست پیام ها</p>\n                    <p>افراد آنلاین (۴ نفر)</p>\n                </div>\n                {contacts.map((item, i) => {\n                    console.log(item)\n                    // Return the element. Also pass key\n                    return (\n                        <ContactItem\n                            key={i}\n                            item={item}\n                            rosterStatusColor={rosterStatusColor}\n                        />\n\n                    );\n                })}\n\n            </div>\n        </React.Fragment>\n    );\n}\n\n\nexport default ContactsList;\n"]},"metadata":{},"sourceType":"module"}